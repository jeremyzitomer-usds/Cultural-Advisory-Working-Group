name: add-name-pronunciations
on:
  issues:
    types: [opened, edited]
permissions:
  issues: write
jobs:
  grab-name-pronunciations:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - shell: bash
        run: |
          declare -A pronunciation_map
          while read n; do
            if [[ $n =~ (- ([A-Za-z ]+): (.*)) ]]; then
                original="${BASH_REMATCH[2]}"
                replacement="${BASH_REMATCH[3]}"
                pronunciation_map["${original}"]="${replacement}"
            fi
          done < name_pronunciations.md
          kudo="${{github.event.issue.title}}"
          for name in "${!pronunciation_map[@]}"; do 
            if [[ "${kudo}" == *"${name}"* ]]; then
              echo "Found the name of a USDSer: \"${name}\". Replacing that with \"${name} (${pronunciation_map["${name}"]})\""
            fi
            kudo=$(echo "${kudo}" | sed -e "s/${name}\(\s*(\([^\(\)]\)*)\)\?/${name} \(${pronunciation_map["${name}"]}\)/g")
          done
          curl -L \
            -X PATCH \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}"\
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/jeremyzitomer-usds/Cultural-Advisory-Working-Group/issues/${{github.event.issue.number}} \
            -d "{\"title\":\"${kudo}\",\"state\":\"open\"}"
